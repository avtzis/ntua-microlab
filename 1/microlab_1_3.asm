
.include "m328PBdef.inc"
.DEF vagoneto=r16;
 
    
ser r18
out DDRD,r18 ;???????????? portd ?? ???? ??????
ldi vagoneto,0x01 ;???????????? ????? ?????????
ldi r24,low(500) ;?????????? ???????? ????????????????? ??? 0.5s ???????
ldi r25,high(500)
clt   ;T-REG=0

move_left:
out portd,vagoneto ;??????? ?????
rcall wait_x_msec ;???????????????? ???? 0.5 secs ???? 1.5secs(???????)
ldi r24,low(500)
ldi r25,high(500)
lsl vagoneto ;?????? ????? 
cpi vagoneto,0x80 ;??????? ??? ?? ???????? ?????? ??? ????
brne move_left ;?? ??? ???????? 
ldi r24,low(1500) ;?? ??? ?????? ??? ???????????????? ??? ?????? ??????????
ldi r25,high(1500)
set ;T-REG=1

move_right:
out portd,vagoneto
rcall wait_x_msec
ldi r24,low(500)
ldi r25,high(500)
lsr vagoneto
cpi vagoneto,0x01
brne move_right
ldi r24,low(1500)
ldi r25,high(1500)
clt
rjmp move_left


wait4:
  ret
    
wait994usec:
    ldi r26,98
 loop:
    rcall wait4
    dec r26 ;
    brne loop
    rcall wait4
    ret
 
    wait990usec:
    ldi r20,98
    loop1:
    rcall wait4
    dec r20 ;
    brne loop1
    nop
    nop
    nop
    ret

continue:
     rcall wait994usec
     rjmp wait_x_msec
    
wait_x_msec:
    sbiw r24,1; 
    brne continue 
    rcall wait990usec
    ret

    
    
   




